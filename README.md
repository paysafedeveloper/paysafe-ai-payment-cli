# PaysafePilot

**PaysafePilot** is an AI-generated Python CLI tool that allows developers to simulate card payments, cancellations, and refunds against the **Paysafe test environment**. It was built using the Paysafe API documentation and common simulator scenarios to validate payment behaviors.

> ⚠️ This tool was generated using generative AI (ChatGPT). Use responsibly in test environments only.

---

## Features

- Fetch and display payment methods per currency
- Submit simulated test card payments
- Asynchronous polling to detect completion
- Optional refund via settlement ID
- Optional cancel for delayed test scenarios
- Logs and tracebacks saved for diagnostics
- Smart comparison with expected responses (`expect_response.json`)

---

## Requirements

- Python 3.8+
- `requests`, `rich`
- A valid Paysafe test account

Install:

```bash
pip install -r requirements.txt
```

---

## Setup

Create an environment file like:

```json
{
  "values": [
    { "key": "public_key", "value": "your_public_key", "enabled": true },
    { "key": "private_key", "value": "your_private_key", "enabled": true },
    { "key": "account_id_cards_usd", "value": "account_for_usd", "enabled": true },
    { "key": "account_id_cards_gbp", "value": "account_for_gbp", "enabled": true }
  ]
}
```

Create `expect_response.json` (optional):

```json
[
  { "error_code": "3015", "response": "Refer to issuer" },
  { "error_code": "3022", "response": "Insufficient funds" }
]
```

---

## Usage

```bash
python main.py --env ./paysafe-test.json --currency USD --amount 4
```

### Flags:

| Flag        | Description                                                |
|-------------|------------------------------------------------------------|
| `--env`     | Path to Postman-style env JSON                             |
| `--currency`| USD or GBP                                                 |
| `--amount`  | Amount in minor units (e.g. 400 = $4.00)                   |
| `--refund`  | Attempt refund after successful payment                    |
| `--cancel`  | Try canceling if the simulator value (90–99) causes delays |

---

## Simulator Examples

```bash
# Success
python main.py --env secrets/paysafe-test.json --currency USD --amount 1

# Step-up / Manual call
python main.py --env secrets/paysafe-test.json --currency USD --amount 4

# Cancel for delayed value
python main.py --env secrets/paysafe-test.json --currency USD --amount 91 --cancel

# Refund after completion
python main.py --env secrets/paysafe-test.json --currency USD --amount 400 --refund
```

---

## Notes

- Refunds use `settlementId` and are polled until completion.
- Cancels are issued via `PUT` to `/payments/{id}` with `"status": "CANCELLED"`.
- Tracebacks are saved in temp files with shell instructions for inspection.

---

## License

MIT License. Generated by AI. Validate behavior manually before production-like testing.
```